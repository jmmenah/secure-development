#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <unistd.h>
#include <signal.h>
#include <time.h>

// --------------------------------------------------- SETUP
void ignore_me_init_buffering() {
	setvbuf(stdout, NULL, _IONBF, 0);
	setvbuf(stdin, NULL, _IONBF, 0);
	setvbuf(stderr, NULL, _IONBF, 0);
}

void kill_on_timeout(int sig) {
  if (sig == SIGALRM) {
        printf("[!] Anti DoS Signal.");
        _exit(0);
  }
}

void ignore_me_init_signal() {
	signal(SIGALRM, kill_on_timeout);
	alarm(60);
}
// ----------------------------------------------------- SETUP
    
char* welcome[] ={
    "Hi, I'm pps, how are you?\n",
    "Today is a great day. Tell me something.\n",
    "Great day to hack.\n",
    "How are you today?\n",
    "PPS is a great module. Don't you think so?\n"
};

char * msg[] = {
    "Take it easy, don't be nervous.\n",
    "Take it easy. It takes time to learn.\n",
    "I also have that opinion.\n",
    "Tell me more about that.\n",
    "Interesting...\n",
    "I hear you. Tell me more things.\n",
    "Soon you will see the reward for your effort.\n",
    "Pown is difficult but you can do it.\n",
    "Tomorrow will be a better day.\n",
    "El profesor de PPS puede ayudarte.\n"
};

void menu() {
    printf("************************************\n");
    printf("**  Welcome to the psychologist   **\n"); 
    printf("**  of the cybersecurity course   **\n");
    printf("**  of the ies virgen del carmen  **\n");
    printf("************************************\n");
}

void goodby() {
    printf("*******************************\n");
    printf("**           Thanks          **\n");
    printf("** All your mental illnesses **\n");
    printf("**      have been cured      **\n");
    printf("*******************************\n");
}

int start_level() {
    char buf[96];
    int r;
    int c = 10;
    menu();

    srand(time(NULL));
    r = rand() % 5;
    printf("%s", welcome[r]);
    fflush(stdout);
    while(c > 0) {
        printf("> ");
        fflush(stdout);
        fgets(buf, 160, stdin);
        printf("You: ");
        printf(buf);
        r = rand() % 10;
        printf("Me: ");
        printf("%s", msg[r]);
        c--;
    }
    goodby();
}

int main() {
  ignore_me_init_buffering(); //Modo buffers unbuffered.
  ignore_me_init_signal();  //Evita ataques DoS.

  start_level();
}
