#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <unistd.h>
#include <signal.h>

// --------------------------------------------------- SETUP
void ignore_me_init_buffering() {
	setvbuf(stdout, NULL, _IONBF, 0);
	setvbuf(stdin, NULL, _IONBF, 0);
	setvbuf(stderr, NULL, _IONBF, 0);
}

void kill_on_timeout(int sig) {
  if (sig == SIGALRM) {
        printf("[!] Anti DoS Signal.");
        _exit(0);
  }
}

void ignore_me_init_signal() {
	signal(SIGALRM, kill_on_timeout);
	alarm(60);
}
// ----------------------------------------------------- SETUP
   
#define MAX 100

int start_level() {
    char buf[MAX];
    float n1, n2, result;
    char operator;
    printf("*************************** The calculator PPS ****************************\n");
    printf("********************************|%x|*********************************\n", buf);
    printf("***************************************************************************\n");
    printf("Number 1: ");
    gets(buf);
    n1 = atof(buf);
    printf("Operator [+, -, *, /]: ");
    fgets(buf, 3, stdin);
    operator = buf[0];
    printf("Number 2: ");
    fgets(buf, MAX, stdin);
    n2 = atof(buf);
    
    if (operator == '/' && n2 == 0.0) {
        printf("No se puede dividir por 0\n");
        exit(1);
    }

    switch (operator)
    {
        case '+':
            result = n1 + n2;
            break;
        case '-':
            result = n1 - n2;
            break;
        case '*':
            result = n1 * n2;
            break;
        case '/':
            result = n1 / n2;
            break;
        default:
            printf("Not a valid operator.\n");
            exit(1);
    }
    printf("%f %c %f = %f\n", n1, operator, n2, result);
    printf("***************************************************************************\n");
}

int main() {
  ignore_me_init_buffering(); //Modo buffers unbuffered.
  ignore_me_init_signal();  //Evita ataques DoS.

  start_level();
}
